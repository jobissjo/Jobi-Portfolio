<div class="chatbot-widget-container" *ngIf="isVisible">

    <!-- Chat Panel -->
    <div class="chat-panel" [class.open]="isOpen" [class.closed]="!isOpen">
        <div class="chat-header">
            <div class="header-info">
                <div class="avatar-icon">
                    <!-- Robot Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 8V4H8" />
                        <rect width="16" height="12" x="4" y="8" rx="2" />
                        <path d="M2 14h2" />
                        <path d="M20 14h2" />
                        <path d="M15 13v2" />
                        <path d="M9 13v2" />
                    </svg>
                </div>
                <div class="title-container">
                    <h3>Ask about my work</h3>
                </div>
            </div>
            <button class="close-btn" (click)="closeChat()" aria-label="Minimize chat">
                <!-- Chevron Down -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m6 9 6 6 6-6" />
                </svg>
            </button>
        </div>

        <div class="chat-body" #scrollContainer>
            <div class="message" *ngFor="let msg of messages" [ngClass]="{'bot': msg.isBot, 'user': !msg.isBot}">
                <div class="bubble">
                    {{ msg.text }}
                </div>
            </div>

            <div class="loading-indicator" *ngIf="isLoading">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>

        <div class="chat-footer">
            <form (ngSubmit)="sendMessage()">
                <input #chatInput type="text" [(ngModel)]="userMessage" name="userMessage"
                    placeholder="Ask me anything about this portfolio..." autocomplete="off" [disabled]="isLoading">
                <button type="submit" [disabled]="!userMessage.trim() || isLoading" aria-label="Send message"
                    class="send-btn">
                    <!-- Send Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m22 2-7 20-4-9-9-4Z" />
                        <path d="M22 2 11 13" />
                    </svg>
                </button>
            </form>
        </div>
    </div>

    <!-- Toggle Button -->
    <button class="chat-toggle" (click)="toggleChat()" [class.active]="isOpen" [attr.aria-expanded]="isOpen"
        aria-label="Open chat">
        <div class="toggle-icon-wrapper">
            <!-- Message Icon -->
            <svg *ngIf="!isOpen" class="icon-open" xmlns="http://www.w3.org/2000/svg" width="28" height="28"
                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
            </svg>
            <!-- Close Icon (X) could be used, or just hide the button like requested 'Expand into chat panel' -->
            <!-- Prompt says: "Chatbot icon... On click, smoothly expand into a chat panel... Panel slides up... and can be minimized or closed" -->
            <!-- Often the button transforms or disappears. "Chatbot icon fixed... On click, smoothly expand". -->
            <!-- I will make the button disappear/transform into the panel or stay as a trigger. -->
            <!-- "Input field fixed at bottom" implies the panel is what we engage with. -->
            <!-- I'll fade out the button when open and fade in the panel. -->
        </div>
    </button>
</div>